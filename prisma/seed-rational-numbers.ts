import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
  console.log('๐ฑ ุจุฏุก ุงุณุชูุฑุงุฏ ุฏุฑุณ ุงูุฃุนุฏุงุฏ ุงููุงุทูุฉ...');

  // 1. ุงูุจุญุซ ุนู ุงููุนูู ูุงููุงุฏุฉ ูุงููุณุชูู
  // ููุชุฑุถ ูุฌูุฏ ูุนููุ ููุงุฏุฉ ุงูุฑูุงุถูุงุชุ ููุณุชูู ุงูุซุงูุซุฉ ูุชูุณุท
  // ููููู ุชุนุฏูู ุงูุฃุณูุงุก ููุง ูุชุทุงุจู ูุง ูุฏูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  const teacher = await prisma.user.findFirst({
    where: { role: { name: 'teacher' } },
  });

  const subject = await prisma.subject.findFirst({
    where: { name: { contains: 'ุงูุฑูุงุถูุงุช' } },
  });

  const level = await prisma.level.findFirst({
    where: { name: { contains: 'ุซุงูุซุฉ ูุชูุณุท' } }, // ุฃู "ุงูุณูุฉ ุงูุซุงูุซุฉ ูุชูุณุท" ุญุณุจ ุงูุชุณููุฉ ูุฏูู
  });

  if (!teacher || !subject || !level) {
    console.error('โ ุฎุทุฃ: ูู ูุชู ุงูุนุซูุฑ ุนูู ุงููุนููุ ุฃู ูุงุฏุฉ ุงูุฑูุงุถูุงุชุ ุฃู ูุณุชูู ุงูุซุงูุซุฉ ูุชูุณุท.');
    console.log('ูุฑุฌู ุงูุชุฃูุฏ ูู ุชุดุบูู seed.ts ุงูุฃุณุงุณู ุฃููุงู.');
    return;
  }

  console.log(`โ ุชู ุงูุนุซูุฑ ุนูู: ุงููุนูู (${teacher.firstName})ุ ุงููุงุฏุฉ (${subject.name})ุ ุงููุณุชูู (${level.name})`);

  // 2. ุชุฌููุฒ ูุญุชูู ุงูุฏุฑุณ (HTML)
  // ุชู ุชุญููู Markdown ุฅูู HTML ูุชูุงูู ูุน RichTextEditor
  const lessonContent = `
    <h1>ุงุณุชูุดุงู ุนุงูู ุงูุฃุนุฏุงุฏ ุงููุงุทูุฉ</h1>
    <p>ุชูุนุฏ ุงูุฃุนุฏุงุฏ ุงููุงุทูุฉ ุญุฌุฑ ุงูุฒุงููุฉ ูู ููู ููุงููู ุงูุฑูุงุถูุงุช ุงูุฃุณุงุณูุฉ ูุทูุงุจ ุงูุตู ุงูุซุงูุซ ุงููุชูุณุท.</p>

    <h2>1. ูุง ูู ุงูุฃุนุฏุงุฏ ุงููุงุทูุฉุ</h2>
    <p>ุงูุนุฏุฏ ุงููุงุทู ูู ุนุฏุฏ ูููู ุงูุชุนุจูุฑ ุนูู ูู ุตูุฑุฉ ูุณุฑ \\(\\frac{a}{b}\\)ุ ุญูุซ \\(a\\) ูู ุนุฏุฏ ุตุญูุญ (ุงูุจุณุท) ู \\(b\\) ูู ุนุฏุฏ ุตุญูุญ ุบูุฑ ุตูุฑู (ุงูููุงู).</p>
    <ul>
      <li><strong>ุงููุชุงุจุฉ ุงููุณุฑูุฉ:</strong> ูููู ุฏุงุฆููุง ุชูุซูู ุงูุนุฏุฏ ุงููุงุทู ููุณุฑ ุนุงุฏู ุฃู ุนุดุฑู.</li>
      <li><strong>ุงููุชุงุจุฉ ุงูุนุดุฑูุฉ:</strong> ุชููู ุงููุชุงุจุฉ ุงูุนุดุฑูุฉ ููุฃุนุฏุงุฏ ุงููุงุทูุฉ ุฅูุง ููุชููุฉ (ูุซู 0.25) ุฃู ุฏูุฑูุฉ (ูุซู \\(0.\\overline{3}\\)).</li>
    </ul>

    <h2>2. ุงูุนูููุงุช ุงูุญุณุงุจูุฉ ุนูู ุงูุฃุนุฏุงุฏ ุงููุงุทูุฉ</h2>
    
    <h3>ุงูุฌูุน ูุงูุทุฑุญ</h3>
    <p>ูุฌูุน ุฃู ุทุฑุญ ูุณุฑูู ูุงุทูููุ ูุฌุจ ุชูุญูุฏ ุงูููุงูุงุช ุฃููุงู:</p>
    $$ \\frac{a}{b} \\pm \\frac{c}{d} = \\frac{ad \\pm bc}{bd} $$
    <p><strong>ูุซุงู:</strong> \\(\\frac{3}{4} + \\frac{1}{2} = \\frac{3}{4} + \\frac{2}{4} = \\frac{5}{4}\\)</p>

    <h3>ุงูุถุฑุจ</h3>
    <p>ูุถุฑุจ ุงูุจุณุท ูู ุงูุจุณุท ูุงูููุงู ูู ุงูููุงู:</p>
    $$ \\frac{a}{b} \\times \\frac{c}{d} = \\frac{ac}{bd} $$
    <p><strong>ูุซุงู:</strong> \\((- \\frac{2}{5}) \\times \\frac{3}{4} = -\\frac{6}{20} = -\\frac{3}{10}\\)</p>

    <h3>ุงููุณูุฉ</h3>
    <p>ูุถุฑุจ ุงููุณุฑ ุงูุฃูู ูู ููููุจ ุงููุณุฑ ุงูุซุงูู:</p>
    $$ \\frac{a}{b} \\div \\frac{c}{d} = \\frac{a}{b} \\times \\frac{d}{c} $$

    <h2>3. ููุงุฑูุฉ ูุชุจุณูุท ุงูุฃุนุฏุงุฏ ุงููุงุทูุฉ</h2>
    <p>ูููุงุฑูุฉ ุนุฏุฏูู ูุงุทูููุ ูููู ุชูุญูุฏ ุงูููุงูุงุช ุฃู ุงุณุชุฎุฏุงู ุงูุถุฑุจ ุงูุชุจุงุฏูู. ูุชุจุณูุท ูุณุฑุ ููุณู ุงูุจุณุท ูุงูููุงู ุนูู ุงููุงุณู ุงููุดุชุฑู ุงูุฃูุจุฑ.</p>

    <h2>4. ุงูุชุญูููุงุช</h2>
    <p><strong>ูู ูุณุฑ ุฅูู ุนุดุฑู:</strong> ููุณู ุงูุจุณุท ุนูู ุงูููุงู (ูุซุงู: \\(3 \\div 8 = 0.375\\)).</p>
    <p><strong>ูู ุนุดุฑู ููุชูู ุฅูู ูุณุฑ:</strong> ููุชุจ ุงูุนุฏุฏ ูุจุณุท ูุงูููุงู ููุฉ ููุนุฏุฏ 10 (ูุซุงู: \\(0.625 = \\frac{625}{1000} = \\frac{5}{8}\\)).</p>
  `;

  // 3. ุฅูุดุงุก ุงูุฏุฑุณ
  const lesson = await prisma.lesson.create({
    data: {
      title: 'ุงูุฃุนุฏุงุฏ ุงููุงุทูุฉ: ุงูุนูููุงุช ูุงูุฎุตุงุฆุต',
      content: lessonContent,
      subjectId: subject.id,
      levelId: level.id,
      authorId: teacher.id,
      type: 'public', // ุฏุฑุณ ุนุงู
      status: 'approved',
      imageUrl: 'https://storage.googleapis.com/e-object-409003.firebasestorage.app/rational-numbers-3rd-middle-school-6s2s9acqgv.jpg', // ุงูุตูุฑุฉ ูู ุงูููู ุงูุฃุตูู
    },
  });

  console.log(`โ ุชู ุฅูุดุงุก ุงูุฏุฑุณ: "${lesson.title}" (ID: ${lesson.id})`);

  // 4. ุฅุถุงูุฉ ุงูุชูุงุฑูู (ูู ูุณู "ุณูุงุณู ุชูุงุฑูู ุฅุถุงููุฉ")
  console.log('๐ ุฌุงุฑู ุฅุถุงูุฉ ุงูุชูุงุฑูู...');

  const exercisesData = [
    {
      question: 'ุงุญุณุจ ูุงุชุฌ ุงูุฌูุน ุงูุชุงูู: \\(\\frac{7}{7} + \\frac{2}{5}\\)',
      modelAnswer: '\\(\\frac{7}{5}\\) ุฃู 1.4',
      maxScore: 2,
    },
    {
      question: 'ุงุญุณุจ ูุงุชุฌ ุงูุถุฑุจ: \\((-3) \\times \\frac{-4}{5}\\)',
      modelAnswer: '\\(\\frac{12}{5}\\) ุฃู 2.4',
      maxScore: 2,
    },
    {
      question: 'ูุงุฑู ุจูู ุงููุณุฑูู: \\(\\frac{3}{5}\\) ู \\(\\frac{2}{3}\\) (ุงุณุชุฎุฏู ุงูุฑููุฒ < ุฃู > ุฃู =)',
      modelAnswer: '\\(\\frac{3}{5} < \\frac{2}{3}\\) (ูุฃู 9 < 10)',
      maxScore: 2,
    },
    {
      question: 'ุงุญุณุจ ุงููุฌููุน: \\(\\frac{1}{4} + \\frac{2}{6}\\)',
      modelAnswer: '\\(\\frac{7}{12}\\)',
      maxScore: 3,
    },
    {
      question: 'ุงุญุณุจ ุงููุฑู: \\(\\frac{5}{8} - \\frac{1}{4}\\)',
      modelAnswer: '\\(\\frac{3}{8}\\)',
      maxScore: 3,
    },
    {
      question: 'ุงุญุณุจ ุงูุฌุฏุงุก: \\(\\frac{1}{3} \\times \\frac{5}{8}\\)',
      modelAnswer: '\\(\\frac{5}{24}\\)',
      maxScore: 2,
    },
    {
      question: 'ูุฑูุจ ุงูุนุฏุฏ 4.368 ุฅูู ุฃูุฑุจ ุนุดุฑ (ุฌุฒุก ูู ุนุดุฑุฉ).',
      modelAnswer: '4.4',
      maxScore: 2,
    },
    {
      question: 'ุญูู ุงููุณุฑ \\(\\frac{7}{8}\\) ุฅูู ุนุฏุฏ ุนุดุฑู.',
      modelAnswer: '0.875',
      maxScore: 2,
    },
  ];

  for (const [index, ex] of exercisesData.entries()) {
    await prisma.exercise.create({
      data: {
        lessonId: lesson.id,
        type: 'main', // ุชูุฑูู ุฑุฆูุณู ููุจู ุงูุชุตุญูุญ
        questionRichContent: `<p>${ex.question}</p>`,
        question: ex.question, // ูููุต ุงูุจุณูุท
        modelAnswer: `<p>${ex.modelAnswer}</p>`,
        maxScore: ex.maxScore,
        displayOrder: index + 1,
        allowRetry: true,
        maxAttempts: 3,
      },
    });
  }

  console.log(`โ ุชู ุฅุถุงูุฉ ${exercisesData.length} ุชูุฑูู ููุฏุฑุณ.`);
  console.log('๐ ุงูุชููุช ุงูุนูููุฉ ุจูุฌุงุญ!');
}

main()
  .catch((e) => {
    console.error('โ ุญุฏุซ ุฎุทุฃ:', e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });